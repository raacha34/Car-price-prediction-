import streamlit as st
import pandas as pd
import numpy as np
import joblib

# Function to load and preprocess data for dropdowns
@st.cache_data
def load_data():
    df = pd.read_csv('Car_features.csv')
    df.columns = df.columns.str.lower().str.replace(' ', '_')

    string_columns = list(df.dtypes[df.dtypes == 'object'].index)
    for col in string_columns:
        df[col] = df[col].str.lower().str.replace(' ', '_')

    return df, string_columns

# Load the trained model and scaler
model = joblib.load('ridge_model.pkl')
scaler = joblib.load('scaler.pkl')
# List of columns expected by the model after one-hot encoding (from your training data)
expected_columns = ['year', 'engine_hp', 'engine_cylinders', 'number_of_doors', 'highway_mpg', 'city_mpg', 'popularity', 'price', 'log_price', 'make_acura', 'make_alfa_romeo', 'make_aston_martin', 'make_audi', 'make_bentley', 'make_bmw', 'make_bugatti', 'make_buick', 'make_cadillac', 'make_chevrolet', 'make_chrysler', 'make_dodge', 'make_ferrari', 'make_fiat', 'make_ford', 'make_genesis', 'make_gmc', 'make_honda', 'make_hummer', 'make_hyundai', 'make_infiniti', 'make_kia', 'make_lamborghini', 'make_land_rover', 'make_lexus', 'make_lincoln', 'make_lotus', 'make_maserati', 'make_maybach', 'make_mazda', 'make_mclaren', 'make_mercedes-benz', 'make_mitsubishi', 'make_nissan', 'make_oldsmobile', 'make_plymouth', 'make_pontiac', 'make_porsche', 'make_rolls-royce', 'make_saab', 'make_scion', 'make_spyker', 'make_subaru', 'make_suzuki', 'make_tesla', 'make_toyota', 'make_volkswagen', 'make_volvo', 'model_100', 'model_124_spider', 'model_190-class', 'model_1_series', 'model_1_series_m', 'model_2', 'model_200', 'model_200sx', 'model_240', 'model_240sx', 'model_2_series', 'model_3', 'model_300', 'model_300-class', 'model_3000gt', 'model_300m', 'model_300zx', 'model_323', 'model_350-class', 'model_350z', 'model_360', 'model_370z', 'model_3_series', 'model_3_series_gran_turismo', 'model_400-class', 'model_420-class', 'model_456m', 'model_458_italia', 'model_4_series', 'model_4_series_gran_coupe', 'model_4c', 'model_4runner', 'model_5', 'model_500', 'model_500-class', 'model_500e', 'model_500l', 'model_500x', 'model_550', 'model_560-class', 'model_57', 'model_570s', 'model_575m', 'model_599', 'model_5_series', 'model_5_series_gran_turismo', 'model_6', 'model_600-class', 'model_6000', 'model_612_scaglietti', 'model_62', 'model_626', 'model_650s_coupe', 'model_650s_spider', 'model_6_series', 'model_6_series_gran_coupe', 'model_718_cayman', 'model_740', 'model_760', 'model_780', 'model_7_series', 'model_80', 'model_850', 'model_86', 'model_8_series', 'model_9-2x', 'model_9-3', 'model_9-3_griffin', 'model_9-4x', 'model_9-5', 'model_9-7x', 'model_90', 'model_900', 'model_9000', 'model_911', 'model_928', 'model_929', 'model_940', 'model_944', 'model_960', 'model_968', 'model_a3', 'model_a4', 'model_a4_allroad', 'model_a5', 'model_a6', 'model_a7', 'model_a8', 'model_acadia', 'model_acadia_limited', 'model_accent', 'model_acclaim', 'model_accord', 'model_accord_crosstour', 'model_accord_hybrid', 'model_accord_plug-in_hybrid', 'model_achieva', 'model_activehybrid_5', 'model_activehybrid_7', 'model_activehybrid_x6', 'model_aerio', 'model_aerostar', 'model_alero', 'model_allante', 'model_allroad', 'model_allroad_quattro', 'model_alpina', 'model_alpina_b6_gran_coupe', 'model_alpina_b7', 'model_altima', 'model_altima_hybrid', 'model_amanti', 'model_amg_gt', 'model_armada', 'model_arnage', 'model_aspen', 'model_aspire', 'model_astro', 'model_astro_cargo', 'model_ats', 'model_ats-v', 'model_ats_coupe', 'model_aurora', 'model_avalanche', 'model_avalon', 'model_avalon_hybrid', 'model_avenger', 'model_aventador', 'model_aveo', 'model_aviator', 'model_axxess', 'model_azera', 'model_aztek', 'model_azure', 'model_azure_t', 'model_b-class_electric_drive', 'model_b-series', 'model_b-series_pickup', 'model_b-series_truck', 'model_b9_tribeca', 'model_baja', 'model_beetle', 'model_beetle_convertible', 'model_beretta', 'model_black_diamond_avalanche', 'model_blackwood', 'model_blazer', 'model_bolt_ev', 'model_bonneville', 'model_borrego', 'model_boxster', 'model_bravada', 'model_breeze', 'model_bronco', 'model_bronco_ii', 'model_brooklands', 'model_brougham', 'model_brz', 'model_c-class', 'model_c-max_hybrid', 'model_c/k_1500_series', 'model_c/k_2500_series', 'model_c30', 'model_c36_amg', 'model_c43_amg', 'model_c70', 'model_c8', 'model_cabrio', 'model_cabriolet', 'model_cadenza', 'model_caliber', 'model_california', 'model_california_t', 'model_camaro', 'model_camry', 'model_camry_hybrid', 'model_camry_solara', 'model_canyon', 'model_caprice', 'model_captiva_sport', 'model_caravan', 'model_carrera_gt', 'model_cascada', 'model_catera', 'model_cavalier', 'model_cayenne', 'model_cayman', 'model_cayman_s', 'model_cc', 'model_celebrity', 'model_celica', 'model_century', 'model_challenger', 'model_charger', 'model_chevy_van', 'model_ciera', 'model_cirrus', 'model_city_express', 'model_civic', 'model_civic_crx', 'model_civic_del_sol', 'model_cl', 'model_cl-class', 'model_cla-class', 'model_classic', 'model_clk-class', 'model_cls-class', 'model_cobalt', 'model_colorado', 'model_colt', 'model_concorde', 'model_continental', 'model_continental_flying_spur', 'model_continental_flying_spur_speed', 'model_continental_gt', 'model_continental_gt3-r', 'model_continental_gt_speed', 'model_continental_gt_speed_convertible', 'model_continental_gtc', 'model_continental_gtc_speed', 'model_continental_supersports', 'model_continental_supersports_convertible', 'model_contour', 'model_contour_svt', 'model_corniche', 'model_corolla', 'model_corolla_im', 'model_corrado', 'model_corsica', 'model_corvette', 'model_corvette_stingray', 'model_coupe', 'model_cr-v', 'model_cr-z', 'model_cressida', 'model_crossfire', 'model_crosstour', 'model_crosstrek', 'model_crown_victoria', 'model_cruze', 'model_cruze_limited', 'model_ct6', 'model_ct_200h', 'model_cts', 'model_cts-v', 'model_cts-v_coupe', 'model_cts-v_wagon', 'model_cts_coupe', 'model_cts_wagon', 'model_cube', 'model_custom_cruiser', 'model_cutlass', 'model_cutlass_calais', 'model_cutlass_ciera', 'model_cutlass_supreme', 'model_cx-3', 'model_cx-5', 'model_cx-7', 'model_cx-9', 'model_dakota', 'model_dart', 'model_dawn', 'model_daytona', 'model_db7', 'model_db9', 'model_db9_gt', 'model_dbs', 'model_defender', 'model_deville', 'model_diablo', 'model_diamante', 'model_discovery', 'model_discovery_series_ii', 'model_discovery_sport', 'model_dts', 'model_durango', 'model_dynasty', 'model_e-150', 'model_e-250', 'model_e-class', 'model_e-golf', 'model_e-series_van', 'model_e-series_wagon', 'model_e55_amg', 'model_echo', 'model_eclipse', 'model_eclipse_spyder', 'model_edge', 'model_eighty-eight', 'model_eighty-eight_royale', 'model_elantra', 'model_elantra_coupe', 'model_elantra_gt', 'model_elantra_touring', 'model_eldorado', 'model_electra', 'model_element', 'model_elise', 'model_enclave', 'model_encore', 'model_endeavor', 'model_entourage', 'model_envision', 'model_envoy', 'model_envoy_xl', 'model_envoy_xuv', 'model_enzo', 'model_eos', 'model_equator', 'model_equinox', 'model_equus', 'model_es_250', 'model_es_300', 'model_es_300h', 'model_es_330', 'model_es_350', 'model_escalade', 'model_escalade_esv', 'model_escalade_ext', 'model_escalade_hybrid', 'model_escape', 'model_escape_hybrid', 'model_escort', 'model_esprit', 'model_estate_wagon', 'model_esteem', 'model_eurovan', 'model_evora', 'model_evora_400', 'model_ex', 'model_ex35', 'model_excel', 'model_exige', 'model_expedition', 'model_explorer', 'model_explorer_sport', 'model_explorer_sport_trac', 'model_expo', 'model_express', 'model_express_cargo', 'model_f-150', 'model_f-150_heritage', 'model_f-150_svt_lightning', 'model_f-250', 'model_f12_berlinetta', 'model_f430', 'model_festiva', 'model_ff', 'model_fiesta', 'model_firebird', 'model_fit', 'model_fit_ev', 'model_five_hundred', 'model_fj_cruiser', 'model_fleetwood', 'model_flex', 'model_flying_spur', 'model_focus', 'model_focus_rs', 'model_focus_st', 'model_forenza', 'model_forester', 'model_forte', 'model_fox', 'model_fr-s', 'model_freelander', 'model_freestar', 'model_freestyle', 'model_frontier', 'model_fusion', 'model_fusion_hybrid', 'model_fx', 'model_fx35', 'model_fx45', 'model_fx50', 'model_g-class', 'model_g20', 'model_g3', 'model_g35', 'model_g37', 'model_g37_convertible', 'model_g37_coupe', 'model_g37_sedan', 'model_g5', 'model_g6', 'model_g8', 'model_g80', 'model_g_convertible', 'model_g_coupe', 'model_g_sedan', 'model_galant', 'model_gallardo', 'model_genesis', 'model_genesis_coupe', 'model_ghibli', 'model_ghost', 'model_ghost_series_ii', 'model_gl-class', 'model_gla-class', 'model_glc-class', 'model_gle-class', 'model_gle-class_coupe', 'model_gli', 'model_glk-class', 'model_gls-class', 'model_golf', 'model_golf_alltrack', 'model_golf_gti', 'model_golf_r', 'model_golf_sportwagen', 'model_grand_am', 'model_grand_caravan', 'model_grand_prix', 'model_grand_vitara', 'model_grand_voyager', 'model_gransport', 'model_granturismo', 'model_granturismo_convertible', 'model_gs_200t', 'model_gs_300', 'model_gs_350', 'model_gs_400', 'model_gs_430', 'model_gs_450h', 'model_gs_460', 'model_gs_f', 'model_gt', 'model_gt-r', 'model_gti', 'model_gto', 'model_gx_460', 'model_gx_470', 'model_h3', 'model_h3t', 'model_hhr', 'model_highlander', 'model_highlander_hybrid', 'model_horizon', 'model_hr-v', 'model_hs_250h', 'model_huracan', 'model_i-miev', 'model_i3', 'model_i30', 'model_i35', 'model_ia', 'model_ilx', 'model_ilx_hybrid', 'model_im', 'model_impala', 'model_impala_limited', 'model_imperial', 'model_impreza', 'model_impreza_wrx', 'model_insight', 'model_integra', 'model_intrepid', 'model_intrigue', 'model_iq', 'model_is_200t', 'model_is_250', 'model_is_250_c', 'model_is_300', 'model_is_350', 'model_is_350_c', 'model_is_f', 'model_j30', 'model_jetta', 'model_jetta_gli', 'model_jetta_hybrid', 'model_jetta_sportwagen', 'model_jimmy', 'model_journey', 'model_juke', 'model_justy', 'model_jx', 'model_k900', 'model_kizashi', 'model_lacrosse', 'model_lancer', 'model_lancer_evolution', 'model_lancer_sportback', 'model_land_cruiser', 'model_landaulet', 'model_laser', 'model_le_baron', 'model_le_mans', 'model_leaf', 'model_legacy', 'model_legend', 'model_lesabre', 'model_levante', 'model_lfa', 'model_lhs', 'model_loyale', 'model_lr2', 'model_lr3', 'model_lr4', 'model_ls', 'model_ls_400', 'model_ls_430', 'model_ls_460', 'model_ls_600h_l', 'model_lss', 'model_ltd_crown_victoria', 'model_lucerne', 'model_lumina', 'model_lumina_minivan', 'model_lx_450', 'model_lx_470', 'model_lx_570', 'model_m', 'model_m-class', 'model_m2', 'model_m3', 'model_m30', 'model_m35', 'model_m37', 'model_m4', 'model_m45', 'model_m4_gts', 'model_m5', 'model_m56', 'model_m6', 'model_m6_gran_coupe', 'model_macan', 'model_magnum', 'model_malibu', 'model_malibu_classic', 'model_malibu_hybrid', 'model_malibu_limited', 'model_malibu_maxx', 'model_mark_lt', 'model_mark_vii', 'model_mark_viii', 'model_matrix', 'model_maxima', 'model_maybach', 'model_mazdaspeed_3', 'model_mazdaspeed_6', 'model_mazdaspeed_mx-5_miata', 'model_mazdaspeed_protege', 'model_mdx', 'model_metris', 'model_metro', 'model_mighty_max_pickup', 'model_millenia', 'model_mirage', 'model_mirage_g4', 'model_mkc', 'model_mks', 'model_mkt', 'model_mkx', 'model_mkz', 'model_mkz_hybrid', 'model_ml55_amg', 'model_model_s', 'model_monaco', 'model_montana', 'model_montana_sv6', 'model_monte_carlo', 'model_montero', 'model_montero_sport', 'model_mp4-12c', 'model_mpv', 'model_mr2', 'model_mr2_spyder', 'model_mulsanne', 'model_murano', 'model_murano_crosscabriolet', 'model_murcielago', 'model_mustang', 'model_mustang_svt_cobra', 'model_mx-3', 'model_mx-5_miata', 'model_mx-6', 'model_navajo', 'model_navigator', 'model_neon', 'model_new_beetle', 'model_new_yorker', 'model_ninety-eight', 'model_nitro', 'model_nsx', 'model_nv200', 'model_nx', 'model_nx_200t', 'model_nx_300h', 'model_odyssey', 'model_omni', 'model_optima', 'model_optima_hybrid', 'model_outback', 'model_outlander', 'model_outlander_sport', 'model_pacifica', 'model_panamera', 'model_park_avenue', 'model_park_ward', 'model_paseo', 'model_passat', 'model_passport', 'model_pathfinder', 'model_phaeton', 'model_phantom', 'model_phantom_coupe', 'model_phantom_drophead_coupe', 'model_pickup', 'model_pilot', 'model_precis', 'model_prelude', 'model_previa', 'model_prius', 'model_prius_c', 'model_prius_prime', 'model_prius_v', 'model_prizm', 'model_probe', 'model_protege', 'model_protege5', 'model_prowler', 'model_pt_cruiser', 'model_pulsar', 'model_q3', 'model_q40', 'model_q45', 'model_q5', 'model_q50', 'model_q60_convertible', 'model_q60_coupe', 'model_q7', 'model_q70', 'model_quattroporte', 'model_quest', 'model_qx', 'model_qx4', 'model_qx50', 'model_qx56', 'model_qx60', 'model_qx70', 'model_qx80', 'model_r-class', 'model_r32', 'model_r8', 'model_rabbit', 'model_raider', 'model_rainier', 'model_rally_wagon', 'model_ram_150', 'model_ram_250', 'model_ram_50_pickup', 'model_ram_cargo', 'model_ram_pickup_1500', 'model_ram_van', 'model_ram_wagon', 'model_ramcharger', 'model_range_rover', 'model_range_rover_evoque', 'model_range_rover_sport', 'model_ranger', 'model_rapide', 'model_rapide_s', 'model_rav4', 'model_rav4_ev', 'model_rav4_hybrid', 'model_rc_200t', 'model_rc_300', 'model_rc_350', 'model_rc_f', 'model_rdx', 'model_reatta', 'model_regal', 'model_regency', 'model_rendezvous', 'model_reno', 'model_reventon', 'model_ridgeline', 'model_rio', 'model_riviera', 'model_rl', 'model_rlx', 'model_roadmaster', 'model_rogue', 'model_rogue_select', 'model_rondo', 'model_routan', 'model_rs_4', 'model_rs_5', 'model_rs_6', 'model_rs_7', 'model_rsx', 'model_rx-7', 'model_rx-8', 'model_rx_300', 'model_rx_330', 'model_rx_350', 'model_rx_400h', 'model_rx_450h', 'model_s-10', 'model_s-10_blazer', 'model_s-15', 'model_s-15_jimmy', 'model_s-class', 'model_s2000', 'model_s3', 'model_s4', 'model_s40', 'model_s5', 'model_s6', 'model_s60', 'model_s60_cross_country', 'model_s7', 'model_s70', 'model_s8', 'model_s80', 'model_s90', 'model_safari', 'model_safari_cargo', 'model_samurai', 'model_santa_fe', 'model_santa_fe_sport', 'model_savana', 'model_savana_cargo', 'model_sc_300', 'model_sc_400', 'model_sc_430', 'model_scoupe', 'model_sebring', 'model_sedona', 'model_sentra', 'model_sephia', 'model_sequoia', 'model_seville', 'model_shadow', 'model_shelby_gt350', 'model_shelby_gt500', 'model_sidekick', 'model_sienna', 'model_sierra_1500', 'model_sierra_1500_classic', 'model_sierra_1500_hybrid', 'model_sierra_1500hd', 'model_sierra_c3', 'model_sierra_classic_1500', 'model_sigma', 'model_silhouette', 'model_silver_seraph', 'model_silverado_1500', 'model_silverado_1500_classic', 'model_silverado_1500_hybrid', 'model_sixty_special', 'model_skylark', 'model_sl-class', 'model_slc-class', 'model_slk-class', 'model_slr_mclaren', 'model_sls_amg', 'model_sls_amg_gt', 'model_sls_amg_gt_final_edition', 'model_slx', 'model_solstice', 'model_sonata', 'model_sonata_hybrid', 'model_sonic', 'model_sonoma', 'model_sorento', 'model_soul', 'model_soul_ev', 'model_spark', 'model_spark_ev', 'model_spectra', 'model_spirit', 'model_sportage', 'model_sportvan', 'model_spyder', 'model_sq5', 'model_srt_viper', 'model_srx', 'model_ss', 'model_ssr', 'model_stanza', 'model_stealth', 'model_stratus', 'model_sts', 'model_sts-v', 'model_suburban', 'model_sunbird', 'model_sundance', 'model_sunfire', 'model_superamerica', 'model_supersports_convertible_isr', 'model_supra', 'model_svx', 'model_swift', 'model_sx4', 'model_syclone', 'model_t100', 'model_tacoma', 'model_tahoe', 'model_tahoe_hybrid', 'model_tahoe_limited/z71', 'model_taurus', 'model_taurus_x', 'model_tc', 'model_tempo', 'model_tercel', 'model_terrain', 'model_terraza', 'model_thunderbird', 'model_tiburon', 'model_tiguan', 'model_titan', 'model_tl', 'model_tlx', 'model_toronado', 'model_torrent', 'model_touareg', 'model_touareg_2', 'model_town_and_country', 'model_town_car', 'model_tracker', 'model_trailblazer', 'model_trailblazer_ext', 'model_trans_sport', 'model_transit_connect', 'model_transit_wagon', 'model_traverse', 'model_trax', 'model_tribeca', 'model_tribute', 'model_tribute_hybrid', 'model_truck', 'model_tsx', 'model_tsx_sport_wagon', 'model_tt', 'model_tt_rs', 'model_tts', 'model_tucson', 'model_tundra', 'model_typhoon', 'model_uplander', 'model_v12_vanquish', 'model_v12_vantage', 'model_v12_vantage_s', 'model_v40', 'model_v50', 'model_v60', 'model_v60_cross_country', 'model_v70', 'model_v8', 'model_v8_vantage', 'model_v90', 'model_van', 'model_vanagon', 'model_vandura', 'model_vanquish', 'model_vanwagon', 'model_veloster', 'model_venture', 'model_venza', 'model_veracruz', 'model_verano', 'model_verona', 'model_versa', 'model_versa_note', 'model_veyron_16.4', 'model_vibe', 'model_vigor', 'model_viper', 'model_virage', 'model_vitara', 'model_voyager', 'model_windstar', 'model_windstar_cargo', 'model_wraith', 'model_wrx', 'model_x-90', 'model_x1', 'model_x3', 'model_x4', 'model_x5', 'model_x5_m', 'model_x6', 'model_x6_m', 'model_xa', 'model_xb', 'model_xc', 'model_xc60', 'model_xc70', 'model_xc90', 'model_xd', 'model_xg300', 'model_xg350', 'model_xl-7', 'model_xl7', 'model_xlr', 'model_xlr-v', 'model_xt', 'model_xt5', 'model_xterra', 'model_xts', 'model_xv_crosstrek', 'model_yaris', 'model_yaris_ia', 'model_yukon', 'model_yukon_denali', 'model_yukon_hybrid', 'model_yukon_xl', 'model_z3', 'model_z4', 'model_z4_m', 'model_z8', 'model_zdx', 'model_zephyr', 'engine_fuel_type_diesel', 'engine_fuel_type_electric', 'engine_fuel_type_flex-fuel_(premium_unleaded_recommended/e85)', 'engine_fuel_type_flex-fuel_(premium_unleaded_required/e85)', 'engine_fuel_type_flex-fuel_(unleaded/e85)', 'engine_fuel_type_flex-fuel_(unleaded/natural_gas)', 'engine_fuel_type_natural_gas', 'engine_fuel_type_premium_unleaded_(recommended)', 'engine_fuel_type_premium_unleaded_(required)', 'engine_fuel_type_regular_unleaded', 'transmission_type_automated_manual', 'transmission_type_automatic', 'transmission_type_direct_drive', 'transmission_type_manual', 'transmission_type_unknown', 'driven_wheels_all_wheel_drive', 'driven_wheels_four_wheel_drive', 'driven_wheels_front_wheel_drive', 'driven_wheels_rear_wheel_drive', 'market_category_crossover', 'market_category_crossover,diesel', 'market_category_crossover,exotic,luxury,high-performance', 'market_category_crossover,exotic,luxury,performance', 'market_category_crossover,factory_tuner,luxury,high-performance', 'market_category_crossover,factory_tuner,luxury,performance', 'market_category_crossover,factory_tuner,performance', 'market_category_crossover,flex_fuel', 'market_category_crossover,flex_fuel,luxury', 'market_category_crossover,flex_fuel,luxury,performance', 'market_category_crossover,flex_fuel,performance', 'market_category_crossover,hatchback', 'market_category_crossover,hatchback,factory_tuner,performance', 'market_category_crossover,hatchback,luxury', 'market_category_crossover,hatchback,performance', 'market_category_crossover,hybrid', 'market_category_crossover,luxury', 'market_category_crossover,luxury,diesel', 'market_category_crossover,luxury,high-performance', 'market_category_crossover,luxury,hybrid', 'market_category_crossover,luxury,performance', 'market_category_crossover,luxury,performance,hybrid', 'market_category_crossover,performance', 'market_category_diesel', 'market_category_diesel,luxury', 'market_category_exotic,factory_tuner,high-performance', 'market_category_exotic,factory_tuner,luxury,high-performance', 'market_category_exotic,factory_tuner,luxury,performance', 'market_category_exotic,flex_fuel,factory_tuner,luxury,high-performance', 'market_category_exotic,flex_fuel,luxury,high-performance', 'market_category_exotic,high-performance', 'market_category_exotic,luxury', 'market_category_exotic,luxury,high-performance', 'market_category_exotic,luxury,high-performance,hybrid', 'market_category_exotic,luxury,performance', 'market_category_exotic,performance', 'market_category_factory_tuner,high-performance', 'market_category_factory_tuner,luxury', 'market_category_factory_tuner,luxury,high-performance', 'market_category_factory_tuner,luxury,performance', 'market_category_factory_tuner,performance', 'market_category_flex_fuel', 'market_category_flex_fuel,diesel', 'market_category_flex_fuel,factory_tuner,luxury,high-performance', 'market_category_flex_fuel,hybrid', 'market_category_flex_fuel,luxury', 'market_category_flex_fuel,luxury,high-performance', 'market_category_flex_fuel,luxury,performance', 'market_category_flex_fuel,performance', 'market_category_flex_fuel,performance,hybrid', 'market_category_hatchback', 'market_category_hatchback,diesel', 'market_category_hatchback,factory_tuner,high-performance', 'market_category_hatchback,factory_tuner,luxury,performance', 'market_category_hatchback,factory_tuner,performance', 'market_category_hatchback,flex_fuel', 'market_category_hatchback,hybrid', 'market_category_hatchback,luxury', 'market_category_hatchback,luxury,hybrid', 'market_category_hatchback,luxury,performance', 'market_category_hatchback,performance', 'market_category_high-performance', 'market_category_hybrid', 'market_category_luxury', 'market_category_luxury,high-performance', 'market_category_luxury,high-performance,hybrid', 'market_category_luxury,hybrid', 'market_category_luxury,performance', 'market_category_luxury,performance,hybrid', 'market_category_performance', 'market_category_performance,hybrid', 'vehicle_size_compact', 'vehicle_size_large', 'vehicle_size_midsize', 'vehicle_style_2dr_hatchback', 'vehicle_style_2dr_suv', 'vehicle_style_4dr_hatchback', 'vehicle_style_4dr_suv', 'vehicle_style_cargo_minivan', 'vehicle_style_cargo_van', 'vehicle_style_convertible', 'vehicle_style_convertible_suv', 'vehicle_style_coupe', 'vehicle_style_crew_cab_pickup', 'vehicle_style_extended_cab_pickup', 'vehicle_style_passenger_minivan', 'vehicle_style_passenger_van', 'vehicle_style_regular_cab_pickup', 'vehicle_style_sedan', 'vehicle_style_wagon']


def main():
    st.title("Car Price Prediction")

    # Load data for dropdowns
    data, string_columns = load_data()

    # User input fields
    city_mpg = st.number_input('City MPG', min_value=0)
    driven_wheels = st.selectbox('Driven Wheels', data['driven_wheels'].unique())
    engine_cylinders = st.number_input('Engine Cylinders', min_value=0)
    engine_fuel_type = st.selectbox('Engine Fuel Type', data['engine_fuel_type'].unique())
    engine_hp = st.number_input('Engine HP', min_value=0)
    highway_mpg = st.number_input('Highway MPG', min_value=0)
    make = st.selectbox('Make', data['make'].unique())
    market_category = st.selectbox('Market Category', data['market_category'].unique())
    model_name = st.selectbox('Model', data['model'].unique())  # Renamed to avoid conflict
    number_of_doors = st.number_input('Number of Doors', min_value=0)
    popularity = st.number_input('Popularity', min_value=0)
    transmission_type = st.selectbox('Transmission Type', data['transmission_type'].unique())
    vehicle_size = st.selectbox('Vehicle Size', data['vehicle_size'].unique())
    vehicle_style = st.selectbox('Vehicle Style', data['vehicle_style'].unique())
    year = st.number_input('Year', min_value=1980, max_value=2023)

    if st.button('Predict Price'):
        new_car_features = {
            'city_mpg': city_mpg,
            'driven_wheels': driven_wheels,
            'engine_cylinders': engine_cylinders,
            'engine_fuel_type': engine_fuel_type,
            'engine_hp': engine_hp,
            'highway_mpg': highway_mpg,
            'make': make,
            'market_category': market_category,
            'model': model_name,
            'number_of_doors': number_of_doors,
            'popularity': popularity,
            'transmission_type': transmission_type,
            'vehicle_size': vehicle_size,
            'vehicle_style': vehicle_style,
            'year': year
        }
        
        new_car_df = pd.DataFrame([new_car_features])

    # One-hot encoding for categorical features
    new_car_df = pd.get_dummies(new_car_df)

    # Add missing columns with default value 0
    for col in expected_columns:
        if col not in new_car_df.columns and col != 'log_price':
            new_car_df[col] = 0

    # Reorder columns to match the training dataset, excluding 'log_price'
    new_car_df = new_car_df.reindex(columns=[col for col in expected_columns if col != 'log_price'], fill_value=0)

    # Scaling
    new_car_scaled = scaler.transform(new_car_df)

    # Prediction
    new_car_log_price = model.predict(new_car_scaled)
    predicted_price = np.expm1(new_car_log_price)

    # Display the prediction
    st.write(f'Predicted Price: ${predicted_price[0]:.2f}')



if __name__ == "__main__":
    main()
